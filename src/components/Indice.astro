---
import type { Item, Vendor } from "../data/indiceItems.ts";
import { indiceItems } from "../data/indiceItems.ts";

const path = Astro.url.pathname;

const orderVendors: { key: Vendor; label: string }[] = [
  { key: "general", label: "Tecnologías de uso general" },
  { key: "nvidia", label: "NVIDIA" },
  { key: "amd", label: "AMD" },
  { key: "intel", label: "Intel" },
  { key: "apis", label: "APIs gráficas" },
];

const activeClass = (href: string) => (path === href ? "active font-semibold text-primary" : "");
const ariaCurrent = (href: string) => (path === href ? "page" : undefined);

const itemsByVendor = new Map<string, Item[]>();
for (const v of orderVendors) itemsByVendor.set(v.key, []);
for (const it of indiceItems) {
  itemsByVendor.get(it.vendor)!.push(it);
}
for (const arr of itemsByVendor.values()) {
  arr.sort((a, b) => a.titleEs.localeCompare(b.titleEs, "es", { sensitivity: "base" }));
}
---

<ul class="menu bg-base-100 rounded-box w-64">
  {
    orderVendors.map((section) => {
      const items = itemsByVendor.get(section.key) || [];
      return (
        <li class="border border-base-300 mb-2 rounded-box">
          <details class="group" open={path.startsWith(`/${section.key}`)}>
            <summary class="font-semibold flex items-center">
              {section.key === "general" && <i class="bi bi-gear text-primary" />}
              {section.key === "nvidia" && <i class="bi bi-nvidia text-success" />}
              {section.key === "amd" && <i class="bi bi-amd text-error" />}
              {section.key === "intel" && <img src="/intel_icon.svg" alt="Intel" class="w-4 h-4" loading="eager" />}
              {section.key === "apis" && <i class="bi bi-braces text-warning" />}
              <span class="ms-2">{section.label}</span>
              <i class="ms-auto transition-transform duration-200 group-open:rotate-180" />
            </summary>
            <ul>
              {items.map((item) => (
                <li>
                  <a href={item.href} class={activeClass(item.href)} aria-current={ariaCurrent(item.href)}>
                    {item.titleEs}
                  </a>
                </li>
              ))}
            </ul>
          </details>
        </li>
      );
    })
  }
</ul>
